# 合成数ハンター 要件定義書（修正版 v3）

## 1. 概要

### 1.1 プロダクト概要

**合成数ハンター**は、素因数分解を戦略的バトルゲームとして体験できるモバイルアプリケーションです。プレイヤーは素数を武器として合成数モンスターと戦い、勝利により新たな素数を獲得していく教育的エンターテイメントアプリです。

### 1.2 ターゲットユーザー

- **主要ターゲット**: 中学生〜高校生（12-18 歳）
- **副次ターゲット**: 数学に興味のある大人、教育関係者
- **想定ユーザー数**: 初年度 1 万ダウンロード目標

### 1.3 主要価値提案

- 素因数分解の概念を直感的に理解できる
- ゲーム要素により数学学習が楽しくなる
- 戦略的思考力を育成できる

## 2. 機能要件

### 2.1 ステージシステム（FR001-FR010）

#### FR001: ステージ選択機能

- **概要**: プレイヤーが挑戦するステージを選択する
- **ステージ構成**: 難易度別に複数のステージを用意
- **解放条件**: 前のステージクリアで次ステージが解放
- **持込制限**: 各ステージごとに持ち込み可能なアイテム数が設定
- **表示情報**: ステージ難易度、推奨レベル、持込制限数、報酬プレビュー

#### FR002: アイテム選択画面

- **概要**: ステージ選択後、バトルで使用するアイテムを選択
- **制限**: ステージごとに決められた数のアイテムのみ選択可能
- **表示**: 所持アイテム一覧から持込制限数分を選択
- **確認**: 選択したアイテムの確認画面
- **キャンセル**: ステージ選択に戻る機能

#### FR003: 初期アイテム配布

- **初期配布**: 素数「2」を 3 個、「3」を 2 個付与
- **チュートリアル**: 段階的なアイテム追加配布
- **配布記録**: 獲得履歴の管理

### 2.2 戦闘システム（FR011-FR020）

#### FR011: 基本攻撃機能

- **概要**: 選択したアイテム（素数）で合成数敵を攻撃する
- **使用制限**: ステージ開始時に選択したアイテムのみ使用可能
- **入力**: バトル用アイテムから使用する素数の選択
- **成功条件**: 敵の数値を選択した素数で除算可能
- **失敗条件**: 敵の数値が選択した素数で割り切れない
- **素数攻撃失敗**: すでに素数となっている敵への攻撃は全て失敗
- **消費システム**: 攻撃成功/失敗に関わらず、使用したアイテムはバトル用在庫から 1 減算

#### FR012: 勝利判定機能

- **概要**: 敵が素数になったとユーザーが判断した時点で勝利宣言
- **判定方法**: ユーザーが「勝利宣言」ボタンを押下
- **正解時**: 最後に残った素数を獲得、その敵を撃破
- **誤判定時**: 制限時間から 10 秒減算、「まだ合成数です。続けてください」と表示
- **教育効果**: ユーザー自身が素数を見極める力を養成

#### FR013: リタイア機能

- **概要**: 戦略的にステージから撤退する
- **実行**: いつでもリタイア可能
- **ペナルティ**: 獲得済みアイテムの没収（ステージ開始前の状態に戻る）

#### FR014: 制限時間システム

- **小さな敵（6-20）**: 30 秒
- **中程度（21-100）**: 60 秒
- **大きな敵（101-1000）**: 90 秒
- **時間切れ**: 自動的にリタイア扱い、獲得アイテム没収

#### FR015: 連続戦闘システム

- **概要**: ステージ内で複数の敵と連続戦闘
- **敵数**: ステージごとに設定された敵数
- **難易度**: 持込アイテムと敵の組み合わせでバランス調整
- **中断不可**: ステージ途中での中断は不可（リタイアのみ）

### 2.3 アイテム獲得・管理システム（FR021-FR030）

#### FR021: 戦闘報酬システム

- **概要**: 敵を倒すことで素数アイテムを獲得
- **獲得タイミング**: 勝利宣言成功時に最後に残った素数を獲得
- **仮獲得**: ステージ中の獲得アイテムは仮状態で管理
- **確定条件**: ステージクリア時に所持アイテムに正式追加
- **没収条件**: タイムオーバー・リタイア時は仮獲得アイテムを没収

#### FR022: アイテム在庫管理

- **所持アイテム**: プレイヤーの恒久的なアイテム在庫
- **バトル用アイテム**: ステージで使用可能なアイテム（一時的）
- **使用可能性**: バトル用アイテムのみが戦闘で使用可能
- **次回利用**: 新たに獲得したアイテムは次のステージから使用可能

#### FR023: ステージクリア報酬

- **成功時**: 所持アイテム = ステージ開始前アイテム + 獲得アイテム
- **失敗時**: 所持アイテム = ステージ開始前アイテム（獲得分没収）
- **表示**: クリア後の獲得アイテムと最終在庫の表示

#### FR024: アイテムインベントリ機能

- **概要**: 獲得したアイテムを管理・表示する
- **表示形式**: 数値と所持数の一覧
- **ソート**: 数値順、獲得順、使用頻度順
- **検索**: 特定の素数を素早く見つける
- **状態表示**: 使用可能数の明確な表示

#### FR025: 複数個所持機能

- **概要**: 同じ素数を複数個所持可能
- **表示**: 所持数をバッジやゲージで表示
- **管理**: アイテム選択時に使用数を指定

#### FR026: アイテム図鑑機能

- **概要**: 全素数の収集状況を確認
- **表示内容**: 素数値、獲得状況、初回獲得日時
- **進捗表示**: 収集率をパーセンテージで表示
- **豆知識**: 各素数に関する数学的情報

### 2.4 敵生成システム（FR031-FR040）

#### FR031: 合成数敵の生成

- **概要**: ステージ設計に応じた合成数を生成
- **範囲**: 初期 6〜12、最大 10,000 程度
- **調整**: 持込制限とのバランスを考慮した設計
- **種類**: 小さな合成数、中程度、大きな合成数

#### FR032: 敵の視覚化

- **概要**: 合成数をモンスターキャラクターとして表示
- **デザイン**: 数値の大きさに応じた外見変化
- **アニメーション**: 攻撃を受けた際のエフェクト
- **状態表示**: 現在の数値を明確に表示

#### FR033: レア敵システム（累乗敵）

- **概要**: 素数の累乗が特別な敵として出現
- **出現例**: 2³=8、3²=9、5²=25、2⁴=16、3³=27 など
- **出現率**: 通常敵の 10%の確率で出現
- **特別報酬**: 該当素数を累乗数分獲得（2³=8 を倒すと 2 を 3 個獲得）
- **視覚的区別**: 特別なエフェクトや色で通常敵と区別
- **難易度**: 通常の同数値敵と同等（累乗なので実際は攻略しやすい）

#### FR034: 敵タイプ分類

- **通常敵**: 複数の異なる素因数を持つ合成数
- **累乗敵**: 単一素数の累乗（2²、3³、5² など）
- **特殊敵**: 稀に出現する大きな素数を含む合成数

### 2.5 ユーザーインターフェース（FR041-FR050）

#### FR041: ステージ選択画面

- **レイアウト**: ステージ一覧、難易度表示、持込制限情報
- **情報表示**: 推奨レベル、敵数、制限時間、持込アイテム数
- **進行状況**: クリア済み/未クリアの視覚的表示

#### FR042: アイテム選択画面

- **レイアウト**: 所持アイテム一覧、選択済みアイテム、制限数表示
- **操作性**: タップで選択/解除、制限数に達すると選択不可
- **確認機能**: 選択内容の最終確認画面

#### FR043: メイン戦闘画面

- **レイアウト**: 上部（敵表示）、中部（バトル用アイテム）、下部（操作ボタン）
- **情報表示**: 現在の敵数値、残り時間、残りアイテム数
- **操作性**: タップでアイテム選択、スワイプで詳細確認
- **勝利宣言ボタン**: 目立つ位置に配置、素数判定用

#### FR044: アイテム使用 UI

- **表示**: バトル用アイテムの残数を明確に表示
- **状態表示**: 使用可能/残数 0 の視覚的区別
- **個数表示**: 各アイテムの残り使用可能数
- **使用制限**: 残数 0 のアイテムは選択不可

#### FR045: 戦闘アニメーション

- **攻撃エフェクト**: 素数による攻撃の視覚的表現
- **成功/失敗**: 攻撃結果の明確な視覚的フィードバック
- **数値変化**: 敵の数値が変化する過程をアニメーション
- **勝利演出**: 勝利時の祝福エフェクト
- **累乗敵演出**: 特別な獲得アニメーション

#### FR046: 結果表示画面

- **クリア時**: 獲得したアイテム、戦闘時間、使用アイテム数
- **失敗時**: 失敗理由、没収されたアイテム、再挑戦への案内
- **統計**: 累計クリア率、獲得アイテム数

#### FR047: 制限時間表示

- **タイマー**: 見やすい位置に残り時間を表示
- **警告**: 残り 10 秒で色変化・点滅
- **ペナルティ表示**: リタイア・誤判定時の時間減算エフェクト

### 2.6 チュートリアル（FR051-FR055）

#### FR051: 基本システムチュートリアル

- **内容**: ステージ選択、アイテム選択、基本戦闘の説明
- **実践**: 実際の簡単なステージを通じた学習
- **段階**: 5 つのステップに分けた段階的習得
- **初期配布**: チュートリアル進行に応じてアイテムを追加配布

#### FR052: 戦略学習チュートリアル

- **内容**: 効率的なアイテム選択、攻撃順序の考え方
- **例題**: 複数の攻略パターンの比較
- **応用**: より大きな数への挑戦準備
- **リスク管理**: 失敗時の没収システムの理解

#### FR053: 累乗敵チュートリアル

- **内容**: 累乗敵の特徴と攻略方法の説明
- **実践**: 実際に累乗敵と戦闘
- **報酬説明**: 複数アイテム獲得の仕組み

### 2.7 進行管理（FR061-FR065）

#### FR061: レベルシステム

- **概要**: クリアステージ数とアイテム獲得数に応じたレベル上昇
- **報酬**: レベルアップ時の特典（新ステージ解放等）
- **表示**: 現在レベルと次レベルまでの進捗

#### FR062: 実績システム

- **種類**: 初回クリア、連続クリア、特定アイテム獲得、累乗敵撃破等
- **報酬**: 実績達成時のボーナスアイテム
- **表示**: 実績一覧と達成状況

#### FR063: タイムアタック記録

- **概要**: 各ステージでの最速クリア時間を記録
- **表示**: 個人ベスト記録の一覧
- **目標**: 時間短縮へのモチベーション向上

## 3. 非機能要件

### 3.1 パフォーマンス要件（NFR001-NFR010）

#### NFR001: 応答性能

- **ステージ開始**: 選択から 1 秒以内に戦闘画面表示
- **攻撃処理**: アイテム選択から結果表示まで 0.5 秒以内
- **画面遷移**: 全ての画面遷移を 1 秒以内に完了

#### NFR002: 計算性能

- **素因数分解**: 10,000 以下の数値を 0.1 秒以内に処理
- **素数判定**: リアルタイムでの判定処理
- **大きな数値**: 100,000 以下まで対応（将来拡張）

#### NFR003: メモリ使用量

- **基本動作**: 50MB 以下での動作
- **画像資産**: 圧縮により総容量 30MB 以下
- **メモリリーク**: 長時間プレイでもメモリ増加なし

#### NFR004: タイマー精度

- **制限時間**: 1 秒単位での正確な計測
- **応答性**: タイマー更新による画面遅延なし
- **バックグラウンド**: アプリがバックグラウンドに行ってもタイマー継続

### 3.2 ユーザビリティ要件（NFR011-NFR020）

#### NFR011: 学習容易性

- **初回プレイ**: チュートリアル完了まで 15 分以内
- **基本操作**: 3 回以内の操作で主要機能を理解
- **エラー回復**: 誤操作からの回復が容易

#### NFR012: アクセシビリティ

- **文字サイズ**: 最小 12pt、拡大対応
- **色覚対応**: 色以外でも状態判別可能
- **音声対応**: 重要な情報の音声フィードバック

#### NFR013: 多言語対応

- **初期**: 日本語のみ
- **将来**: 英語対応予定

#### NFR014: 誤判定防止

- **確認ダイアログ**: 勝利宣言時の確認メッセージ
- **ヒント機能**: 素数判定に迷った時のサポート
- **学習サポート**: 間違いから学ぶ仕組み

#### NFR015: アイテム管理の直感性

- **選択画面**: 制限数と選択数の明確な表示
- **残数管理**: バトル中のアイテム残数を常に表示
- **結果予測**: アイテム没収リスクの事前警告

### 3.3 信頼性要件（NFR021-NFR025）

#### NFR021: 可用性

- **稼働率**: オフラインアプリのため 99.9%
- **データ保護**: セーブデータの自動バックアップ
- **回復機能**: アプリクラッシュからの自動回復

#### NFR022: データ整合性

- **保存**: アイテム獲得状況の確実な保存
- **検証**: データ破損の検出と修復
- **移行**: アプリ更新時のデータ継承
- **ロールバック**: 失敗時の確実なデータ復旧

#### NFR023: ゲームバランス

- **ステージ設計**: 持込制限と敵の適切なバランス
- **報酬調整**: 累乗敵の報酬が過度にならない調整
- **時間設定**: 制限時間の適切性
- **没収システム**: 過度なペナルティの防止

### 3.4 保守性要件（NFR031-NFR035）

#### NFR031: 更新容易性

- **ステージ追加**: 新ステージの追加が容易
- **バランス調整**: 難易度・時間制限・持込数の調整機能
- **バグ修正**: 迅速な修正とリリース

#### NFR032: テスト容易性

- **自動テスト**: 主要機能の自動テスト対応
- **デバッグ**: 開発時のデバッグ機能
- **ログ**: 問題調査のためのログ出力

## 4. 制約事項

### 4.1 技術制約（CON001-CON010）

#### CON001: 開発プラットフォーム

- **フレームワーク**: Flutter 必須
- **言語**: Dart 言語での実装
- **IDE**: Android Studio または VS Code 推奨

#### CON002: ターゲットプラットフォーム

- **Android**: API Level 35 以上
- **iOS**: iOS 18.0 以上

#### CON003: オフライン動作

- **ネットワーク**: インターネット接続不要
- **データ**: 全てローカルストレージに保存
- **更新**: アプリ更新時のみネットワーク使用

### 4.2 運用制約（CON011-CON015）

#### CON011: 開発期間

- **MVP 版**: 4 ヶ月以内に完成（ステージシステム追加により延長）
- **機能追加**: 2 ヶ月サイクルでのアップデート
- **保守**: 継続的なバグ修正対応

#### CON012: 開発体制

- **開発者**: 1 名での開発
- **テスト**: 友人・知人による実機テスト
- **フィードバック**: ユーザーレビューによる改善

### 4.3 ビジネス制約（CON021-CON025）

#### CON021: 収益化

- **初期**: 無料アプリとしてリリース
- **将来**: 広告表示または有料版の検討
- **教育**: 教育機関向けライセンスの可能性

#### CON022: 法的制約

- **著作権**: オリジナルコンテンツのみ使用
- **プライバシー**: 個人情報の収集なし
- **年齢制限**: 年齢制限なし（全年齢対象）

## 5. 成功指標

### 5.1 定量指標

- **ダウンロード数**: 初年度 1 万ダウンロード
- **継続率**: 1 週間後の継続率 30%以上
- **平均プレイ時間**: 1 セッション 15 分以上
- **レビュー評価**: 4.0 以上の評価維持
- **勝利判定精度**: ユーザーの正解率 70%以上
- **ステージクリア率**: 各ステージ 50%以上のクリア率

### 5.2 定性指標

- **教育効果**: 素因数分解の理解向上
- **満足度**: ユーザーレビューでの肯定的評価
- **話題性**: SNS での自然な言及・シェア
- **学習効果**: 素数判定能力の向上
- **戦略性**: アイテム選択の戦略的思考力向上

## 6. リスクと対策

### 6.1 技術リスク

- **リスク**: Flutter での複雑なアニメーション実装
- **対策**: プロトタイプでの事前検証、シンプルな代替案準備

### 6.2 ゲームデザインリスク

- **リスク**: アイテム没収システムによるユーザーの過度なストレス
- **対策**: 段階的なペナルティ導入、プレイテストでの調整
- **リスク**: ステージバランスの調整困難
- **対策**: データ分析に基づく動的な難易度調整

### 6.3 教育効果リスク

- **リスク**: アイテム選択が複雑すぎてユーザーが離脱
- **対策**: 段階的な機能解放、チュートリアルの充実

### 6.4 開発リスク

- **リスク**: 1 人開発によるスケジュール遅延
- **対策**: MVP 機能の絞り込み、段階的リリース
- **リスク**: ステージシステム追加による開発負荷増加
- **対策**: シンプルなステージエディター機能の導入

## 7. 今後の拡張計画

### 7.1 短期（3-6 ヶ月）

- iOS 版の追加開発
- UI/UX の改善
- 新しいステージタイプの追加
- アイテム交換システム

### 7.2 中期（6-12 ヶ月）

- オンライン機能の追加
- より大きな数値への対応
- 教育機関向け機能
- マルチプレイヤーモード

### 7.3 長期（1 年以上）

- 他の数学概念への拡張
- 多言語対応
- プラットフォーム拡張（Web 版等）
- AI 対戦機能
