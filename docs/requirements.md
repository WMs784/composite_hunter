# 合成数ハンター 要件定義書（修正版）

## 1. 概要

### 1.1 プロダクト概要

**合成数ハンター**は、素因数分解を戦略的バトルゲームとして体験できるモバイルアプリケーションです。プレイヤーは素数を武器として合成数モンスターと戦い、勝利により新たな素数を獲得していく教育的エンターテイメントアプリです。

### 1.2 ターゲットユーザー

- **主要ターゲット**: 中学生〜高校生（12-18 歳）
- **副次ターゲット**: 数学に興味のある大人、教育関係者
- **想定ユーザー数**: 初年度 1 万ダウンロード目標

### 1.3 主要価値提案

- 素因数分解の概念を直感的に理解できる
- ゲーム要素により数学学習が楽しくなる
- 戦略的思考力を育成できる

## 2. 機能要件

### 2.1 戦闘システム（FR001-FR010）

#### FR001: 基本攻撃機能

- **概要**: 手持ちの素数で合成数敵を攻撃する
- **初期アイテム**: 素数「2」を 3 個付与
- **入力**: 使用する素数の選択
- **処理**: 敵の数値を選択した素数で除算
- **出力**: 攻撃後の敵の状態（新しい数値）
- **消費システム**: 攻撃に使用した素数は所持数から 1 減算
- **例外**: 割り切れない素数は選択不可、在庫 0 の素数は使用不可

#### FR002: 勝利判定機能

- **概要**: 敵が素数になったとユーザーが判断した時点で勝利宣言
- **判定方法**: ユーザーが「勝利宣言」ボタンを押下
- **正解時**: 最後に残った素数を獲得、戦闘終了
- **誤判定時**: 制限時間から 10 秒減算、「まだ合成数です。続けてください」と表示
- **教育効果**: ユーザー自身が素数を見極める力を養成

#### FR003: 逃走機能

- **概要**: 倒せない敵から戦略的に逃走する
- **成功率**: 100%（必ず成功）
- **ペナルティ**: 次回戦闘の制限時間が 10 秒短縮
- **時間プレッシャー**: 連続逃走により時間制限がより厳しくなる

#### FR004: 制限時間システム

- **小さな敵（6-20）**: 30 秒
- **中程度（21-100）**: 60 秒
- **大きな敵（101-1000）**: 90 秒
- **時間切れ**: 自動的に逃走扱い
- **時間短縮**: 逃走・誤判定により次戦闘の時間が減少

#### FR005: 連続戦闘システム

- **概要**: 勝利後に次の敵が自動生成される
- **難易度**: 手持ち素数に応じて調整
- **休憩**: 任意のタイミングで戦闘を中断可能
- **時間回復**: 休憩時に制限時間ペナルティがリセット

### 2.2 素数管理システム（FR011-FR020）

#### FR011: 素数インベントリ機能

- **概要**: 獲得した素数を管理・表示する
- **表示形式**: 数値と所持数の一覧
- **ソート**: 数値順、獲得順、使用頻度順
- **検索**: 特定の素数を素早く見つける
- **在庫管理**: 所持数 0 の素数は使用不可として表示

#### FR012: 複数個所持機能

- **概要**: 同じ素数を複数個所持可能
- **上限**: 小さな素数（2,3,5）は最大 5 個、大きな素数は最大 1 個
- **表示**: 所持数をバッジやゲージで表示
- **管理**: 使用時に所持数から 1 減算、0 になると使用不可

#### FR013: 素数図鑑機能

- **概要**: 全素数の収集状況を確認
- **表示内容**: 素数値、獲得状況、初回獲得日時
- **進捗表示**: 収集率をパーセンテージで表示
- **豆知識**: 各素数に関する数学的情報

#### FR014: 使用履歴機能

- **概要**: 素数の使用状況を記録・表示
- **統計**: 各素数の使用回数、戦闘勝率
- **分析**: 効率的な戦略の提案

### 2.3 ステージ選択システム（FR021-FR025）

#### FR021: ステージ選択画面

- **概要**: プレイヤーが挑戦するステージを選択する
- **ステージ構成**: 
  - ステージ1: 基本の戦闘（敵6-20、制限時間30秒）
  - ステージ2: 中級の挑戦（敵21-100、制限時間60秒）
  - ステージ3: 上級者への道（敵101-1000、制限時間90秒）
  - ステージ4: エキスパート（敵1001-10000、制限時間120秒）
- **アンロック条件**: 前ステージクリアで次ステージ解放
- **進捗表示**: 各ステージの完了状況と星評価（1-3星）

#### FR022: 練習モード

- **概要**: ステージに縛られない自由な戦闘モード
- **敵生成**: プレイヤーレベルに応じた適切な敵
- **制限**: なし（時間制限なし、ペナルティなし）

#### FR023: ステージ進行管理

- **進捗保存**: 各ステージのクリア状況とベストスコア
- **星評価**: 戦闘効率に基づく1-3星評価
- **アンロック**: 段階的なステージ解放システム

### 2.4 敵生成システム（FR026-FR030）

#### FR026: 合成数敵の自動生成

- **概要**: ステージまたはプレイヤーのレベルに応じた合成数を生成
- **範囲**: ステージ仕様に応じて調整、最大 10,000 程度
- **調整**: 手持ち素数で攻略可能な難易度に調整
- **種類**: 小さな合成数、中程度、大きな合成数

#### FR027: 敵の視覚化

- **概要**: 合成数をモンスターキャラクターとして表示
- **デザイン**: 数値の大きさに応じた外見変化
- **アニメーション**: 攻撃を受けた際のエフェクト

#### FR028: レア敵システム（累乗敵）

- **概要**: 素数の累乗が特別な敵として出現
- **出現例**: 2³=8、3²=9、5²=25、2⁴=16、3³=27 など
- **出現率**: 通常敵の 10%の確率で出現
- **特別報酬**: 該当素数を累乗数分獲得（2³=8 を倒すと 2 を 3 個獲得）
- **視覚的区別**: 特別なエフェクトや色で通常敵と区別
- **難易度**: 通常の同数値敵と同等（累乗なので実際は攻略しやすい）

#### FR029: 敵タイプ分類

- **通常敵**: 複数の異なる素因数を持つ合成数
- **累乗敵**: 単一素数の累乗（2²、3³、5² など）
- **特殊敵**: 稀に出現する大きな素数を含む合成数

### 2.5 ユーザーインターフェース（FR031-FR040）

#### FR031: ステージ選択画面UI

- **レイアウト**: ヘッダー（ゲームタイトル）、ステージリスト、練習モードボタン
- **ステージカード**: 番号、タイトル、説明、難易度情報、進捗状況
- **視覚的表現**: ロック状態、完了状態、星評価の明確な表示
- **ナビゲーション**: インベントリ、実績画面へのアクセス

#### FR032: メイン戦闘画面

- **レイアウト**: 上部（敵表示）、中部（手持ち素数）、下部（操作ボタン）
- **情報表示**: 現在の敵数値、残り時間、戦闘状況
- **操作性**: タップで素数選択、スワイプで詳細確認
- **勝利宣言ボタン**: 目立つ位置に配置、素数判定用

#### FR033: 素数選択 UI

- **表示**: グリッド形式で手持ち素数を一覧表示
- **状態表示**: 使用可能/不可能/在庫切れの視覚的区別
- **個数表示**: 各素数の所持数を明確に表示
- **在庫管理**: 所持数 0 の素数はグレーアウト表示

#### FR033: 戦闘アニメーション

- **攻撃エフェクト**: 素数による攻撃の視覚的表現
- **数値変化**: 敵の数値が変化する過程をアニメーション
- **勝利演出**: 勝利時の祝福エフェクト
- **累乗敵演出**: 特別な獲得アニメーション

#### FR034: 結果表示画面

- **勝利時**: 獲得した素数、戦闘時間、使用素数
- **逃走時**: 時間ペナルティの警告、次回への影響
- **誤判定時**: 正しい判定方法のヒント
- **統計**: 累計勝率、獲得素数数

#### FR035: 制限時間表示

- **タイマー**: 見やすい位置に残り時間を表示
- **警告**: 残り 10 秒で色変化・点滅
- **ペナルティ表示**: 逃走・誤判定時の時間減算エフェクト

### 2.5 チュートリアル（FR041-FR045）

#### FR041: 基本操作チュートリアル

- **内容**: 攻撃方法、勝利条件、逃走方法の説明
- **実践**: 実際の戦闘を通じた学習
- **段階**: 5 つのステップに分けた段階的習得
- **初期配布**: チュートリアル進行に応じて素数を追加配布

#### FR042: 戦略学習チュートリアル

- **内容**: 効率的な攻撃順序、素数の使い分け
- **例題**: 複数の攻略パターンの比較
- **応用**: より大きな数への挑戦
- **素数判定**: 素数を見極める練習

#### FR043: 累乗敵チュートリアル

- **内容**: 累乗敵の特徴と攻略方法の説明
- **実践**: 実際に累乗敵と戦闘
- **報酬説明**: 複数素数獲得の仕組み

### 2.6 進行管理（FR051-FR055）

#### FR051: レベルシステム

- **概要**: 獲得素数数に応じたレベル上昇
- **報酬**: レベルアップ時の特典（新機能解放等）
- **表示**: 現在レベルと次レベルまでの進捗

#### FR052: 実績システム

- **種類**: 初回勝利、連続勝利、特定素数獲得、累乗敵撃破等
- **報酬**: 実績達成時のボーナス素数
- **表示**: 実績一覧と達成状況

#### FR053: タイムアタック記録

- **概要**: 各敵サイズでの最速クリア時間を記録
- **表示**: 個人ベスト記録の一覧
- **目標**: 時間短縮へのモチベーション向上

## 3. 非機能要件

### 3.1 パフォーマンス要件（NFR001-NFR010）

#### NFR001: 応答性能

- **戦闘開始**: タップから 1 秒以内に戦闘画面表示
- **攻撃処理**: 素数選択から結果表示まで 0.5 秒以内
- **画面遷移**: 全ての画面遷移を 1 秒以内に完了

#### NFR002: 計算性能

- **素因数分解**: 10,000 以下の数値を 0.1 秒以内に処理
- **素数判定**: リアルタイムでの判定処理
- **大きな数値**: 100,000 以下まで対応（将来拡張）

#### NFR003: メモリ使用量

- **基本動作**: 50MB 以下での動作
- **画像資産**: 圧縮により総容量 20MB 以下
- **メモリリーク**: 長時間プレイでもメモリ増加なし

#### NFR004: タイマー精度

- **制限時間**: 1 秒単位での正確な計測
- **応答性**: タイマー更新による画面遅延なし
- **バックグラウンド**: アプリがバックグラウンドに行ってもタイマー継続

### 3.2 ユーザビリティ要件（NFR011-NFR020）

#### NFR011: 学習容易性

- **初回プレイ**: チュートリアル完了まで 10 分以内
- **基本操作**: 3 回以内の操作で主要機能を理解
- **エラー回復**: 誤操作からの回復が容易

#### NFR012: アクセシビリティ

- **文字サイズ**: 最小 12pt、拡大対応
- **色覚対応**: 色以外でも状態判別可能
- **音声対応**: 重要な情報の音声フィードバック

#### NFR013: 多言語対応

- **初期**: 日本語のみ
- **将来**: 英語対応予定

#### NFR014: 誤判定防止

- **確認ダイアログ**: 勝利宣言時の確認メッセージ
- **ヒント機能**: 素数判定に迷った時のサポート
- **学習サポート**: 間違いから学ぶ仕組み

### 3.3 信頼性要件（NFR021-NFR025）

#### NFR021: 可用性

- **稼働率**: オフラインアプリのため 99.9%
- **データ保護**: セーブデータの自動バックアップ
- **回復機能**: アプリクラッシュからの自動回復

#### NFR022: データ整合性

- **保存**: 素数獲得状況の確実な保存
- **検証**: データ破損の検出と修復
- **移行**: アプリ更新時のデータ継承

#### NFR023: ゲームバランス

- **難易度調整**: プレイヤーレベルに応じた適切な敵生成
- **報酬バランス**: 累乗敵の報酬が過度にならない調整
- **時間設定**: 制限時間の適切性

### 3.4 保守性要件（NFR031-NFR035）

#### NFR031: 更新容易性

- **機能追加**: 新素数、新敵の追加が容易
- **バランス調整**: 難易度・時間制限の調整機能
- **バグ修正**: 迅速な修正とリリース

#### NFR032: テスト容易性

- **自動テスト**: 主要機能の自動テスト対応
- **デバッグ**: 開発時のデバッグ機能
- **ログ**: 問題調査のためのログ出力

## 4. 制約事項

### 4.1 技術制約（CON001-CON010）

#### CON001: 開発プラットフォーム

- **フレームワーク**: Flutter 必須
- **言語**: Dart 言語での実装
- **IDE**: Android Studio または VS Code 推奨

#### CON002: ターゲットプラットフォーム

- **Android**: API Level 35 以上
- **iOS**: iOS 18.0 以上

#### CON003: オフライン動作

- **ネットワーク**: インターネット接続不要
- **データ**: 全てローカルストレージに保存
- **更新**: アプリ更新時のみネットワーク使用

### 4.2 運用制約（CON011-CON015）

#### CON011: 開発期間

- **MVP 版**: 3 ヶ月以内に完成
- **機能追加**: 2 ヶ月サイクルでのアップデート
- **保守**: 継続的なバグ修正対応

#### CON012: 開発体制

- **開発者**: 1 名での開発
- **テスト**: 友人・知人による実機テスト
- **フィードバック**: ユーザーレビューによる改善

### 4.3 ビジネス制約（CON021-CON025）

#### CON021: 収益化

- **初期**: 無料アプリとしてリリース
- **将来**: 広告表示または有料版の検討
- **教育**: 教育機関向けライセンスの可能性

#### CON022: 法的制約

- **著作権**: オリジナルコンテンツのみ使用
- **プライバシー**: 個人情報の収集なし
- **年齢制限**: 年齢制限なし（全年齢対象）

## 5. 成功指標

### 5.1 定量指標

- **ダウンロード数**: 初年度 1 万ダウンロード
- **継続率**: 1 週間後の継続率 30%以上
- **平均プレイ時間**: 1 セッション 10 分以上
- **レビュー評価**: 4.0 以上の評価維持
- **勝利判定精度**: ユーザーの正解率 70%以上

### 5.2 定性指標

- **教育効果**: 素因数分解の理解向上
- **満足度**: ユーザーレビューでの肯定的評価
- **話題性**: SNS での自然な言及・シェア
- **学習効果**: 素数判定能力の向上

## 6. リスクと対策

### 6.1 技術リスク

- **リスク**: Flutter での複雑なアニメーション実装
- **対策**: プロトタイプでの事前検証、シンプルな代替案準備

### 6.2 ゲームデザインリスク

- **リスク**: 制限時間によるストレス過多
- **対策**: 段階的な時間制限導入、プレイテストでの調整

### 6.3 教育効果リスク

- **リスク**: 勝利判定が難しすぎてユーザーが離脱
- **対策**: 段階的な難易度上昇、ヒント機能の充実

### 6.4 開発リスク

- **リスク**: 1 人開発によるスケジュール遅延
- **対策**: MVP 機能の絞り込み、段階的リリース

## 7. 今後の拡張計画

### 7.1 短期（3-6 ヶ月）

- iOS 版の追加開発
- UI/UX の改善
- 新しい累乗敵タイプの追加

### 7.2 中期（6-12 ヶ月）

- オンライン機能の追加
- より大きな数値への対応
- 教育機関向け機能

### 7.3 長期（1 年以上）

- 他の数学概念への拡張
- 多言語対応
- プラットフォーム拡張（Web 版等）
